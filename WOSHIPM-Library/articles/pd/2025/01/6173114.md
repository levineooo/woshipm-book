# 图解支付结算平台设计：如何高效给商户结算
{% hint style="info" %}
**Category:** Pd
**Author:** [隐墨星辰](https://www.woshipm.com/u/1598196)
**Published:** 2025-01-20  
**Stats:** 👁️ 3582 views | 💬 0 comments | ⭐ 26 collects
**Tags:** `商户结算` `基础知识` `支付系统` `系统架构`
**Original:** [View on woshipm.com](https://www.woshipm.com/pd/6173114.html)
{% endhint %}
> 本文主要讲清楚支付系统中商户结算涉及的基本概念，产品架构、系统架构，以及一些核心的流程和相关领域模型、状态机设计等。

---

## 图解支付结算平台设计：如何高效给商户结算

[![](https://static.woshipm.com/view/woshipm_api_def_20240921121255_6519.jpg?imageView2/1/w/72/h/72/q/100)](https://www.woshipm.com/u/1598196)

[隐墨星辰](https://www.woshipm.com/u/1598196) ![](https://static.woshipm.com/tag/1101_1@2x.png) 关注

2025-01-20

0 评论 3582 浏览 26 收藏 8 分钟

[B端产品经理要负责对目标行业和市场进行深入的分析和调研，了解客户的需求、痛点、期望和行为，找到产品的价值主张 🔗](https://ke.qidianla.com/courses/bcpm)

> 本文主要讲清楚支付系统中商户结算涉及的基本概念，产品架构、系统架构，以及一些核心的流程和相关领域模型、状态机设计等。

![](https://image.woshipm.com/2024/05/30/0e100bfe-1e5f-11ef-ab7f-00163e142b65.png)

收单结算是支付系统最重要的子域之一，行业内经常把有牌照的支付平台称为“收单机构”就可见一斑。

我们在上一篇文章讲了收单如何帮忙商户收钱，收完钱还得转给商户，用户支付100块钱，那么到底给商户多少钱，什么时候给，这都是结算平台干的工作。谓之“结算”。

下面这个图留着是为了提高“收单、结算、拒付”紧密结合的印象。

![](https://image.woshipm.com/2024/12/22/d0a32f56-c031-11ef-97b6-00163e09d72f.png)

三者的职能如下：

1.  收单核心：主要负责处理商户订单的全生命周期管理：订单创建、支付推进、退款、撤销等。
2.  结算核心：主要负责把商户应收账款算清楚，把结算款按合同约定结转给商户。
3.  拒付核心：主要负责处理用户的拒付和对应的抗辩以及最后的判责。

## 一、结算在支付系统中的位置

![](https://image.woshipm.com/2025/01/20/e717e30a-d6c8-11ef-8cdc-00163e09d72f.png)

在收单机构（支付平台）里，结算就是把帮商户收进来的钱，按约定的结算规则、准确、及时地结算给商户。

## 二、结算产品架构

![](https://image.woshipm.com/2025/01/20/e7a3c000-d6c8-11ef-8cdc-00163e09d72f.png)

结算模式分为主动结算和被动结算。站在商户的角度，被动结算就是以收单机构为准，收单机构说结多少就是多少。主动结算就是以商户为准，商户说结多少就是多少。

[![](https://image.woshipm.com/2023/08/02/58dc678c-30e3-11ee-88e7-00163e0b5ff3.png)

一款产品无到有，产品经理需要做些什么？

在一个产品从无到有的过程中，要做好产品经理这个角色实在是不容易，除了大家都知道的写需求、写需求、写需求，要做的事多着呢。产品经理不是你眼中的只会找你麻烦，提要求..

查看详情 >

](https://ke.qidianla.com/courses/bcpm)

一般来说，大部分商户都是被动结算，特殊的大商户比如Google，Apple经常使用主动结算。

结算一定要设计账期，就像账务系统要有会计日是一样的道理，避免跨天的交易或零点附近的交易出现结算异常。对应就有账期创建、入账、关账、出账。

## 三、结算系统架构

![](https://image.woshipm.com/2025/01/20/e82e5eb8-d6c8-11ef-8cdc-00163e09d72f.png)

核心的服务包括：结算受理、注册，账期的新建、关账、出账，最后就是结算。

## 四、结算核心流程

下面以即时到账模式为例说明。担保交易模式和预授权模式稍有不同。

![](https://image.woshipm.com/2025/01/20/e8de2320-d6c8-11ef-8cdc-00163e09d72f.png)

在交易日，收单收到支付成功回执后，就发消息给结算，结算收到消息去查结算合约，进入结算注册流程。

在结算注册时，如果存在打开的账期，就直接挂过去，如果不存在，就创建一个账期。

在结算日，先进行关账，避免在途任务受影响。关账成功后，进入结算批次，再进入打款流程。

打款有3种情况：

1）结算到商户余额户。

2）在线结算到提现卡。

3）线下人工打款（人工结算）。

打款完成后，推进结算流水SETTLED。

## 五、结算核心领域模型

![](https://image.woshipm.com/2025/01/20/e9734630-d6c8-11ef-8cdc-00163e09d72f.png)

左边绿色部分是账单和流水相关信息，中间蓝色是账期和批次相关信息，右边是打款信息。

因为一个收单可能会有多种费用，所以会生成多条我方账单流水。同样的，一个收单可能结算给多个主体，对应有多笔结算流水。

结算账期有点类似会计日的概念，是为了控制零点左右的收单单据的结算能落到正确的结算账期里去。

关账后就会发起外部结算以及对应的打款。一个结算批次可能会分成多笔打款。

## 六、结算状态机设计

![](https://image.woshipm.com/2025/01/20/ea00d338-d6c8-11ef-8cdc-00163e09d72f.png)

上面把结算涉及到的状态机都画出来了。

特殊的是打款单的状态机，因为打款有可能调用外部渠道打到商户的卡里去，外部渠道有一定概率先返回打款成功，过两天后又返回退票（实际打款失败，资金退回），这个时候需要推进到REVERSE，然后重新更新信息后再进行打款。

退票的原因有多种，比如商户的卡被冻结等。

## 七、资金流

![](https://image.woshipm.com/2025/01/20/ea856206-d6c8-11ef-8cdc-00163e09d72f.png)

结算一般只涉及到正向资金流，也就是支付成功后，一步步推进结算到商户余额户或者商户银行卡，如果是结算到商户余额户，就需要商户主动在商户门户发起提现到卡。

很多人很好奇“为什么要有支付网关过渡户和商户待结算户？能不能直接进商户余额户？”

我的答案是：如果你一定要这么做，也是可以的，但是会给自己埋下很多坑。

我举两个例子：

1\. 从渠道扣款成功，并不代表就一定要结算给商户。比如去外部渠道扣款是有时间消耗的，外部渠道扣款成功后，如果订单已经关闭（用户主动关单或者订单超时关单），这个时候需要给用户把钱原路退回去。所以需要有一个“支付网关过渡户”作为临时的中间户（也是内部户，用户或商户是不可见的），在需要退回时，直接从这个中间户退回去。

2\. 商户是有结算周期的，一般使用T+N表示，这个N可以是0，1，2 … …，从风险角度，比较少使用T+0。

3\. 结算方式是可以使用结算到余额户或卡。如果每笔都直接结算到了卡，发生退款怎么办？还需要有单独一个退款户。大规模交易情况下，这个卡的交易记录也是极多的。

4\. 退款一般从商户待结算户扣回。这样设计更简单。

## 八、结束语

本文主要讲了结算的基本概念，以及对应的产品和系统架构图，一些核心的领域模型和状态机设计。

本文由人人都是产品经理作者【隐墨星辰】，微信公众号：【隐墨星辰】，原创/授权 发布于人人都是产品经理，未经许可，禁止转载。

题图来自Unsplash，基于 CC0 协议。

赞赏 收藏已收藏26 点赞已赞9

更多精彩内容，请关注人人都是产品经理微信公众号或下载App

[商户结算](https://www.woshipm.com/tag/%e5%95%86%e6%88%b7%e7%bb%93%e7%ae%97)[基础知识](https://www.woshipm.com/tag/%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86)[支付系统](https://www.woshipm.com/tag/%e6%94%af%e4%bb%98%e7%b3%bb%e7%bb%9f)[系统架构](https://www.woshipm.com/tag/%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84)

[分享到微博](https://service.weibo.com/share/share.php?appkey=2775287854&title=图解支付结算平台设计：如何高效给商户结算&url=https://www.woshipm.com/pd/6173114.html&pic=https://image.woshipm.com/2024/05/30/0e100bfe-1e5f-11ef-ab7f-00163e142b65.png)

微信扫一扫

![微信二维码](https://api.pwmqr.com/qrcode/create/?url=https://www.woshipm.com/pd/6173114.html)

分享